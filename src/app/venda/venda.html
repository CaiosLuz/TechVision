<app-menu-superior></app-menu-superior>

<div class="container mt-4">
  <h2>Venda</h2>

  <div *ngIf="carrinho.length > 0; else vazio">
    <div class="row">

      <!-- COLUNA ESQUERDA -->
      <div class="col-md-6">

        <div *ngFor="let item of carrinho; let i = index" class="mb-4">
          <div class="card p-3">

            <!-- Imagem -->
            <div class="text-center mb-3">
              <img [src]="item.imagens_produto[0]?.url || 'images/default.png'"
                   class="img-fluid rounded"
                   alt="{{ item.nome }}">
            </div>

            <h5>{{ item.nome }}</h5>

            <p>⭐⭐⭐⭐⭐ ({{ item.avaliacao || 0 }} avaliações)</p>

            <div class="row">
              <div class="col-6">Formato: {{ item.formato }}</div>
              <div class="col-6">Gênero: {{ item.genero }}</div>
            </div>

            <div class="row">
              <div class="col-6">Ponte: {{ item.ponte }}</div>
              <div class="col-6">Largura da Lente: {{ item.largura_lente }}</div>
            </div>

            <div class="mt-2">
              Cores: {{ item.cores?.join(', ') || 'Sem cores' }}
            </div>

            <hr>

            <!-- Tipo e Espessura -->
            <p><strong>Tipo de Lente:</strong> {{ item.tipoLente }}</p>
            <p><strong>Espessura:</strong> {{ item.espessura }}</p>

            <!-- Tratamentos -->
            <div class="mt-2">
              <h6 class="fw-bold">Tratamentos:</h6>

              <p *ngIf="item.tratamentos?.length === 0">
                Nenhum tratamento selecionado
              </p>

              <ul *ngIf="item.tratamentos?.length > 0">
                <li *ngFor="let t of item.tratamentos">
                  {{ t.nome || t }}  <!-- suporta objeto ou string -->
                </li>
              </ul>
            </div>

            <!-- Prescrição -->
            <h6 class="fw-bold mt-3">Prescrição:</h6>

            <p><strong>OD:</strong>
              {{ item.receita?.esfericoOD || '-' }} /
              {{ item.receita?.cilindricoOD || '-' }} /
              {{ item.receita?.eixoOD || '-' }}
            </p>

            <p><strong>OE:</strong>
              {{ item.receita?.esfericoOE || '-' }} /
              {{ item.receita?.cilindricoOE || '-' }} /
              {{ item.receita?.eixoOE || '-' }}
            </p>

            <!-- Preço -->
            <div class="row mt-3">
              <div class="col-6">R$ {{ item.preco | number:'1.2-2' }}</div>
              <div class="col-6">Pix: R$ {{ item.preco_pix | number:'1.2-2' }}</div>
            </div>

            <!-- Quantidade -->
            <div class="d-flex align-items-center mt-3">
              <button class="btn btn-sm btn-outline-secondary" (click)="decrementarQuantidade(i)">-</button>
              <span class="mx-2">{{ item.quantidade }}</span>
              <button class="btn btn-sm btn-outline-secondary" (click)="incrementarQuantidade(i)">+</button>
            </div>

            <button class="btn btn-primary btn-sm mt-3" (click)="continuarComprando()">Adicionar mais produtos</button>
          </div>
        </div>

      </div>

      <!-- COLUNA DIREITA -->
      <div class="col-md-6">
        <div class="card p-3">

          <h5>Resumo do Pedido</h5>

          <p><strong>Total:</strong> R$ {{ total() | number:'1.2-2' }}</p>

          <hr>

          <p><strong>Escolha o meio de pagamento:</strong></p>

          <div class="d-flex flex-column gap-2 mt-3">
            <div class="pagamento-container">
              <h3 class="titulo-pagamento">Meios de Pagamento</h3>

              <div class="lista-pagamentos">
                <label class="item-pagamento" *ngFor="let meio of meiosPagamento">
                  <input 
                    type="checkbox"
                    class="checkbox-pagamento"
                    [checked]="pagamentoSelecionado.includes(meio)"
                    (change)="togglePagamento(meio, $event)"
                  />
                  <span>{{ meio }}</span>
                </label>
              </div>

            </div>

            <button class="btn btn-success w-100" (click)="finalizarPagamento()">
              Finalizar Pagamento
            </button>

            <button class="btn btn-primary mt-3" (click)="finalizarDepois()">
              Finalizar depois
            </button>
          </div>

        </div>
      </div>

    </div>
  </div>

  <ng-template #vazio>
    <p>Seu carrinho está vazio.</p>
  </ng-template>
</div>
